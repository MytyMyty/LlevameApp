"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[8182],{8182:(V,y,u)=>{u.r(y),u.d(y,{HomePageModule:()=>x});var _=u(177),d=u(4742),w=u(4341),b=u(8986),f=u(467),M=u(4412),e=u(4438),C=u(3354),I=u(7144);let S=(()=>{var n;class l{constructor(){}loadGoogleMaps(){const o=window,t=o.google;return t&&t.maps?Promise.resolve(t.maps):new Promise((s,i)=>{const c=document.createElement("script");c.src="https://maps.googleapis.com/maps/api/js?key="+I.c.googleMapsApiKey,c.async=!0,c.defer=!0,document.body.appendChild(c),c.onload=()=>{const p=o.google;p&&p.maps?s(p.maps):i("Google Map SDK is not Available")}})}}return(n=l).\u0275fac=function(o){return new(o||n)},n.\u0275prov=e.jDH({token:n,factory:n.\u0275fac,providedIn:"root"}),l})();var j=u(6267);function R(n,l){if(1&n&&(e.j41(0,"ion-select-option",2),e.EFF(1),e.k0s()),2&n){const a=l.$implicit;e.Y8G("value",a.formatted_address),e.R7$(),e.SpI(" ",a.name," ")}}let E=(()=>{var n;class l{constructor(o){this.placesService=o,this.placeSelected=new e.bkB,this.places=[]}ngOnInit(){this.placesService.getPlaces().subscribe(o=>{console.log(o),this.places=o})}onPlaceSelected(o){const t=this.places.find(s=>s.formatted_address===o.detail.value);t&&(console.log(t.formatted_address),this.placeSelected.emit(t.geometry.location))}}return(n=l).\u0275fac=function(o){return new(o||n)(e.rXU(j._))},n.\u0275cmp=e.VBU({type:n,selectors:[["app-places-dropdown"]],outputs:{placeSelected:"placeSelected"},decls:2,vars:2,consts:[["placeholder","Selecciona tu sede: ",3,"ionChange","value"],[3,"value",4,"ngFor","ngForOf"],[3,"value"]],template:function(o,t){1&o&&(e.j41(0,"ion-select",0),e.bIt("ionChange",function(i){return t.onPlaceSelected(i)}),e.DNE(1,R,2,2,"ion-select-option",1),e.k0s()),2&o&&(e.Y8G("value",null==t.places[2]?null:t.places[2].formatted_address),e.R7$(),e.Y8G("ngForOf",t.places))},dependencies:[_.Sq,d.Nm,d.Ip,d.Je],encapsulation:2}),l})();const F=["map"];function G(n,l){if(1&n){const a=e.RV6();e.j41(0,"ion-item",20),e.bIt("click",function(){const t=e.eBV(a).$implicit,s=e.XpG(2);return e.Njj(s.onPlaceSelect(t))}),e.nrm(1,"ion-icon",21),e.j41(2,"ion-label"),e.EFF(3),e.j41(4,"p")(5,"ion-text"),e.EFF(6),e.k0s()()()()}if(2&n){const a=l.$implicit;e.R7$(3),e.SpI(" ",null==a?null:a.title," "),e.R7$(3),e.SpI(" ",null==a?null:a.address," ")}}function O(n,l){if(1&n&&(e.j41(0,"ion-list"),e.DNE(1,G,7,2,"ion-item",19),e.k0s()),2&n){const a=e.XpG();e.R7$(),e.Y8G("ngForOf",a.places)}}function A(n,l){if(1&n){const a=e.RV6();e.j41(0,"ion-button",22),e.bIt("click",function(){e.eBV(a);const t=e.XpG();return e.Njj(t.confirmPickup())}),e.EFF(1,"SOLICITAR PICKUP"),e.k0s()}}function H(n,l){if(1&n){const a=e.RV6();e.j41(0,"ion-button",23),e.bIt("click",function(){e.eBV(a);const t=e.XpG();return e.Njj(t.cancelPickup())}),e.EFF(1,"CANCELAR PICKUP"),e.k0s()}}const L=[{path:"",component:(()=>{var n;class l{constructor(o,t,s,i,c){this.router=o,this.auth=t,this.gmaps=s,this.renderer=i,this.zone=c,this.center={lat:-33.4328394303453,lng:-70.61491346414431},this.source={lat:-33.4990709,lng:-70.665723},this.dest={lat:-33.47162921236009,lng:-70.65562840595744},this.isPickupRequested=!1,this.places=[],this._places=new M.t([]),this.animationRunning=!1}ngOnInit(){this.placesSub=this.search_places.subscribe({next:o=>{this.places=o},error:o=>{console.log(o)}})}ngOnDestroy(){this.placesSub&&this.placesSub.unsubscribe()}ngAfterViewInit(){this.loadMap(),this.intersectionObserver=new IntersectionObserver(t=>{for(const s of t)s.isIntersecting&&(s.target.classList.add("drop"),this.intersectionObserver.unobserve(s.target))});const o=document.querySelectorAll(".payment");o.forEach(t=>{t.addEventListener("click",()=>{o.forEach(s=>{s.classList.remove("selected")}),t.classList.add("selected")})})}confirmPickup(){this.isPickupRequested=!0,this.startTrip()}startTrip(){console.log("Viaje Iniciado!"),requestAnimationFrame(this.animate)}animate(o){throw new Error("Method not implemented.")}cancelPickup(){this.isPickupRequested=!1,console.log("Viaje Cancelado!")}onPlaceSelected(o){console.log(o),this.loadMap(o)}loadMap(o){var t=this;return(0,f.A)(function*(){try{yield google.maps.importLibrary("maps");const i=yield t.gmaps.loadGoogleMaps(),c=t.mapElementRef.nativeElement,p=o?new i.LatLng(o.lat,o.lng):new i.LatLng(t.center.lat,t.center.lng),{AdvancedMarkerElement:r,PinElement:m}=yield google.maps.importLibrary("marker");t.AdvancesMarkerElement=r,new m({scale:0});const h=new i.Map(c,{mapId:"95f483ddcfa9ba3f",center:p,zoom:12,disableDefaultUI:!0});t.map=h;const v="assets/imgs/car.png",k="assets/imgs/pin.png",P=new i.LatLng(t.source.lat,t.source.lng),T=new i.LatLng(t.dest.lat,t.dest.lng);t.source_marker=yield t.addMarker(P,v),yield t.addMarker(T,k),t.directionsService=new i.DirectionsService,t.directionsDisplay=new i.DirectionsRenderer({map:h}),t.directionsDisplay.setOptions({polylineOptions:{strokeWeight:4,strokeOpacity:1,strokeColor:"black"},supressMarkers:!0}),yield t.drawRoute(o),t.map.setCenter(P),t.renderer.addClass(c,"visible")}catch(s){console.log(s)}})()}addMarker(o,t){var s=this;return(0,f.A)(function*(){try{const i=document.createElement("img");i.src=t,i.height=50,i.width=50;const c=s.AdvancesMarkerElement;console.log(c);const p=new c({map:s.map,position:o,content:i}),r=p.content;return r.style.opacity="0",r.addEventListener("animationend",m=>{r.classList.remove("drop"),r.style.opacity="1"}),s.intersectionObserver.observe(r),p}catch(i){throw i}})()}drawRoute(o){this.cancelAnimation(),this.directionsService.route({origin:this.source,waypoints:[{location:this.dest,stopover:!1}],destination:o?new google.maps.LatLng(o.lat,o.lng):new google.maps.LatLng(this.center.lat,this.center.lng),travelMode:"DRIVING",provideRouteAlternatives:!0},(t,s)=>{if("OK"===s){this.directionsDisplay.setDirections(t),console.log("response:",t);const p=[];t.routes[0].legs[0].steps.forEach(r=>{r.path.forEach(g=>{p.push({lat:g.lat(),lng:g.lng()})})}),this.animateMarkerAlongRoute(p)}else console.log(s)})}animateMarkerAlongRoute(o){let t=0;const s=o.length;Math.floor(s/260),this.animate=()=>{t<s-1?(this.changeMarkerPosition(o[t]),t+=1,setTimeout(()=>{requestAnimationFrame(m=>this.animate(m))},40)):(this.changeMarkerPosition(o[s-1]),this.animationRunning=!1)}}cancelAnimation(){this.animationRunning=!1}changeMarkerPosition(o){this.animateMarker(this.source_marker,{lat:o.lat,lng:o.lng})}animateMarker(o,t){const i=o.position,m=(t.lat-i.lat)/9,g=(t.lng-i.lng)/9;let h=0;const v=()=>{h<9?(o.position=new google.maps.LatLng(i.lat+m*h,i.lng+g*h),h++,requestAnimationFrame(v)):(o.position=t,this.source_marker=o)};v()}logout(){this.auth.logout(),this.router.navigate(["/login"])}onSearchChange(o){var t=this;return(0,f.A)(function*(){console.log(o),t.query=o.detail.value,t.query.length>0&&(yield t.getPlaces())})()}getPlaces(){var o=this;return(0,f.A)(function*(){try{yield(new google.maps.places.AutocompleteService).getPlacePredictions({input:o.query,types:["geocode"],componentRestrictions:{country:"cl"}},i=>{let c=[];o.zone.run(()=>{null!=i&&(i.forEach(function(){var p=(0,f.A)(function*(r){console.log("prediction: ",r);let m=yield o.geoCode(r.description);const g={title:r.structured_formatting.main_text,address:r.description,lat:m.lat,lng:m.lng};console.log("places: ",g),c.push(g)});return function(r){return p.apply(this,arguments)}}()),o._places.next(c))})})}catch(t){console.log(t)}})()}geoCode(o){let t={lat:"",lng:""};return new Promise((s,i)=>{(new google.maps.Geocoder).geocode({address:o},p=>{console.log("Results: ",p),t.lat=p[0].geometry.location.lat(),t.lng=p[0].geometry.location.lng(),s(t)})})}get search_places(){return this._places.asObservable()}onPlaceSelect(o){this.places.length=0,this.geoCode(o.address).then(t=>{this.dest=t,console.log("Selected address:",o.address),console.log("Dest coordinates:",this.dest)})}}return(n=l).\u0275fac=function(o){return new(o||n)(e.rXU(b.Ix),e.rXU(C.$),e.rXU(S),e.rXU(e.sFG),e.rXU(e.SKi))},n.\u0275cmp=e.VBU({type:n,selectors:[["app-home"]],viewQuery:function(o,t){if(1&o&&e.GBs(F,7),2&o){let s;e.mGM(s=e.lsd())&&(t.mapElementRef=s.first)}},decls:35,vars:5,consts:[["map",""],[3,"translucent"],["slot","end"],[3,"click"],["search-icon","search-circle","animated","true","show-clear-button","focus","clear-icon","trash-bin","debounce","800","placeholder","Buscar por area, direccion, lugar...",1,"search-bar",3,"ionInput","value"],[4,"ngIf"],[1,"select-controls"],["size","auto"],["name","school-outline",1,"icon",2,"margin-left","0.5rem"],[1,"places-dropdown",3,"placeSelected"],[1,"map-wrapper"],[1,"map"],[1,"bottom","request-controls"],["width-50",""],["color","light","expand","block",1,"payment"],["name","card"],["name","cash"],["color","medium","expand","block",3,"click",4,"ngIf"],["color","secondary","expand","block",3,"click",4,"ngIf"],["class","ion-margin-top",3,"click",4,"ngFor","ngForOf"],[1,"ion-margin-top",3,"click"],["name","location-outline","slot","start"],["color","medium","expand","block",3,"click"],["color","secondary","expand","block",3,"click"]],template:function(o,t){if(1&o){const s=e.RV6();e.j41(0,"ion-header",1)(1,"ion-toolbar")(2,"ion-title"),e.EFF(3," #LlevameDuoc "),e.k0s(),e.j41(4,"ion-buttons",2)(5,"ion-button",3),e.bIt("click",function(){return e.eBV(s),e.Njj(t.logout())}),e.EFF(6," Cerrar Sesion "),e.k0s()()()(),e.j41(7,"ion-searchbar",4),e.bIt("ionInput",function(c){return e.eBV(s),e.Njj(t.onSearchChange(c))}),e.k0s(),e.j41(8,"ion-content"),e.DNE(9,O,2,1,"ion-list",5),e.j41(10,"ion-row",6)(11,"ion-col",7),e.nrm(12,"ion-icon",8),e.k0s(),e.j41(13,"ion-col")(14,"app-places-dropdown",9),e.bIt("placeSelected",function(c){return e.eBV(s),e.Njj(t.onPlaceSelected(c))}),e.k0s()()(),e.j41(15,"div",10),e.nrm(16,"div",11,0),e.k0s(),e.j41(18,"div",12)(19,"ion-row")(20,"ion-col",13)(21,"ion-button",14),e.nrm(22,"ion-icon",15),e.EFF(23," VISA **45 "),e.k0s()(),e.j41(24,"ion-col",13)(25,"ion-button",14),e.nrm(26,"ion-icon",16),e.EFF(27," EFECTIVO "),e.k0s()()(),e.j41(28,"ion-row")(29,"ion-col"),e.DNE(30,A,2,0,"ion-button",17)(31,H,2,0,"ion-button",18),e.k0s()(),e.j41(32,"ion-row")(33,"ion-col"),e.EFF(34," Tiempo Aproximado de Pickup 5min "),e.k0s()()()()}2&o&&(e.Y8G("translucent",!0),e.R7$(7),e.Y8G("value",""),e.R7$(2),e.Y8G("ngIf",(null==t.places?null:t.places.length)>0),e.R7$(21),e.Y8G("ngIf",!t.isPickupRequested),e.R7$(),e.Y8G("ngIf",t.isPickupRequested))},dependencies:[_.Sq,_.bT,d.Jm,d.QW,d.hU,d.W9,d.eU,d.iq,d.uz,d.he,d.nf,d.ln,d.S1,d.IO,d.BC,d.ai,d.Gw,E],styles:[".home[_ngcontent-%COMP%]{position:relative}.map-wrapper[_ngcontent-%COMP%]{width:100%;height:100%}.map[_ngcontent-%COMP%]{height:100%;width:100%;opacity:0;transition:opacity .15s ease-in}.map.visible[_ngcontent-%COMP%]{opacity:1}.bottom[_ngcontent-%COMP%]{position:absolute;bottom:0;width:100%}.select-controls[_ngcontent-%COMP%]{top:0;width:100%;display:flex;justify-content:space-between;background:linear-gradient(135deg,#007aff,#03a9f4);box-shadow:0 2px 4px #0003;padding:.25rem;box-sizing:border-box;cursor:pointer;color:#fff;font-size:1rem;font-weight:500;transition:all .2s ease-in;height:3rem}.places-dropdown[_ngcontent-%COMP%]{position:absolute;top:0;right:0}.select-controls[_ngcontent-%COMP%]:hover{box-shadow:0 4px 8px #0000004d}.request-controls[_ngcontent-%COMP%]{text-align:center;background:linear-gradient(transparent,#0000004d 40%,#0009)}ion-searchbar[_ngcontent-%COMP%]{width:100vw;justify-content:space-between;align-items:center;padding:.5rem;background:linear-gradient(135deg,#007aff,#03a9f4);box-shadow:0 2px 4px #0003;color:#fff;font-size:1rem;font-weight:500;--placeholder-color: #fff}ion-toolbar[_ngcontent-%COMP%]{width:100vw}"]}),l})()}];let D=(()=>{var n;class l{}return(n=l).\u0275fac=function(o){return new(o||n)},n.\u0275mod=e.$C({type:n}),n.\u0275inj=e.G2t({imports:[b.iI.forChild(L),b.iI]}),l})(),x=(()=>{var n;class l{}return(n=l).\u0275fac=function(o){return new(o||n)},n.\u0275mod=e.$C({type:n}),n.\u0275inj=e.G2t({imports:[_.MD,w.YN,d.bv,D]}),l})()}}]);